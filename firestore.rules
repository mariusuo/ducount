rules_version = '3';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Groups
    match /groups/{groupId} {
      // Anyone can read (needed for sharing links)
      allow read: if true;
      
      // Only authenticated users can create groups
      allow create: if true;
      
      // Only group members (in userIds) can update/delete
      allow update: if request.auth != null && 
        (request.auth.uid in resource.data.userIds || 
         resource.data.createdBy == request.auth.uid);
      
      allow delete: if request.auth != null && 
        resource.data.createdBy == request.auth.uid;
    }
    
    // Expenses - anyone with link can manage (for guest access)
    match /expenses/{expenseId} {
      allow read, write: if true;
    }
    
    // Settlements - anyone with link can manage (for guest access)
    match /settlements/{settlementId} {
      allow read, write: if true;
    }
  }
}
